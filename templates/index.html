<!DOCTYPE html>
<html>
<head>
    <title>Mortgage Calculator</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='mortgage_icon.png') }}">
    <style>
    body {
        font-family: Arial, sans-serif;
        background: #121212;
        color: #e0e0e0;
        max-width: 700px;
        margin: auto;
        padding: 20px;
    }

    h2 {
        color: #ffffff;
        text-align: center;
    }
    h3 {
        color: #ffffff;
        text-align: center;
    }

    input, button {
        padding: 12px;
        width: 100%;
        margin-top: 10px;
        border-radius: 6px;
        border: 1px solid #333;
        font-size: 16px;
    }

    input {
        background: #1e1e1e;
        color: #e0e0e0;
    }

    button {
        background: #228B22;
        color: white;
        border: none;
        cursor: pointer;
        font-weight: bold;
        transition: 0.2s;
    }

    button:hover {
        background: #1a6a1a;
    }

    .result-box {
        margin-top: 20px;
        padding: 15px;
        background: #1e1e1e;
        border: 1px solid #333;
        border-radius: 8px;
    }

    img {
        border: 1px solid #333;
        border-radius: 6px;
    }
</style>

</head>
<body>

<h2>Mortgage Payment and Amortization Calculator</h2>
<h3>Version 1.2.0</h3>

<form method="POST" onsubmit ="stripCommas(this)">
    <label>Mortgage Amount ($)</label>
    <input type="text" name="loan" value="{{ request.form.get('loan', '250000') }}" oninput="formatNumberLive(this)" data-format="number">

    <label>Interest Rate (%)</label>
    <input type="text" name="rate" value="{{ request.form.get('rate', '7') }}" >

    <label>Loan Term (Years)</label>
    <input type="text" name="term" value="{{ request.form.get('term', '30') }}">

    <label>Extra Monthly Payment ($)</label>
    <input type="text" name="extra" value="{{ request.form.get('extra', '100') }}" oninput="formatNumberLive(this)" data-format="number">

    <label>Annual Property Tax ($)</label>
    <input type="text" name="tax" value="{{ request.form.get('tax', '2500') }}" oninput="formatNumberLive(this)" data-format="number">

    <label>Annual Insurance Premium ($)</label>
    <input type="text" name="insurance" value="{{ request.form.get('insurance', '1500') }}" oninput="formatNumberLive(this)" data-format="number">

    <button type="submit">Calculate Payment</button>
</form>

{% if result %}
<div class="result-box">
    {% if result.error %}
        <p style="color: red;">{{ result.error }}</p>
    {% else %}
        <p><b>Base monthly payment:</b> ${{ result.monthlyPayment }}</p>
        <p><b>Total monthly payment:</b> ${{ result.monthlyPayment + result.extra }}</p>
        <p><b>Payoff WITHOUT extra payment:</b> {{ result.payoff1 }} and ${{ result.totalInterest }}K in interest paid.</p>
        <p><b>Payoff WITH extra payment:</b> {{ result.payoff2 }} and ${{ result.totalInterest2 }}K in interest paid.</p>
        <p><b>Total saved :</b> {{ result.saved }} and ${{ result.interestDifference }}k in interest.</p>

        <h3>Payoff Chart</h3>
        <img src="{{ result.plot }}" width="100%" alt = "Amortization plot">
    {% endif %}
</div>
{% endif %}

</body>
</html>
<script>
function formatNumberLive(input) {
    // Save cursor position
    const selectionStart = input.selectionStart;

    // Remove non-digits
    let value = input.value.replace(/[^\d]/g, '');

    if (value === '') {
        input.value = '';
        return;
    }

    // Format number
    input.value = Number(value).toLocaleString('en-US');

    // Restore cursor position safely
    input.setSelectionRange(selectionStart, selectionStart);
}

function stripCommas(form) {
    const inputs = form.querySelectorAll('input[type="text"]');
    inputs.forEach(input => {
        input.value = input.value.replace(/,/g, '');
    });
}
document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll("input[data-format='number']").forEach(input => {
        formatNumberLive(input);
    });
});
</script>
