<!DOCTYPE html>
<html>
<head>
    <title>Mortgage Calculator</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='mortgage_icon.png') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
    body {
        font-family: Arial, sans-serif;
        background: #121212;
        color: #e0e0e0;
        max-width: 700px;
        margin: auto;
        padding: 20px;
    }

    h2 {
        color: #ffffff;
        text-align: center;
    }
    h3 {
        color: #ffffff;
        text-align: center;
    }

    input, button {
        padding: 12px;
        width: 100%;
        margin-top: 10px;
        border-radius: 6px;
        border: 1px solid #333;
        font-size: 16px;
    }

    input {
        background: #1e1e1e;
        color: #e0e0e0;
    }

    button {
        background: #228B22;
        color: white;
        border: none;
        cursor: pointer;
        font-weight: bold;
        transition: 0.2s;
    }

    button:hover {
        background: #1a6a1a;
    }

    .result-box {
        margin-top: 20px;
        padding: 15px;
        background: #1e1e1e;
        border: 1px solid #333;
        border-radius: 8px;
    }

    img {
        border: 1px solid #333;
        border-radius: 6px;
    }
    @media (max-width: 600px) {
    body {
        padding: 15px;
        font-size: 18px;
    }

    h2 {
        font-size: 24px;
    }

    h3 {
        font-size: 18px;
    }

    label {
        font-size: 16px;
    }

    input, button {
        font-size: 18px;
        padding: 14px;
    }

    button {
        margin-top: 15px;
    }
}
</style>

</head>
<body>

<h2>Mortgage Payment and Amortization Calculator</h2>

<form method="POST" onsubmit ="stripCommas(this)">
    <label>Mortgage Amount ($)</label>
    <input type="text" name="loan" value="{{ request.form.get('loan', '250000') }}" oninput="formatNumberLive(this)" data-format="number"  inputmode="numeric" pattern="[0-9,.]*">

    <label>Interest Rate (%)</label>
    <input type="text" name="rate" value="{{ request.form.get('rate', '7') }}" oninput="formatNumberLive(this)" data-format="number" inputmode="numeric" pattern="[0-9.]*">

    <label>Loan Term (Years)</label>
    <input type="text" name="term" value="{{ request.form.get('term', '30') }}" oninput="formatNumberLive(this)" data-format="number" inputmode="numeric" pattern="[0-9,.]*">

    <label>Extra Monthly Payment ($)</label>
    <input type="text" name="extra" value="{{ request.form.get('extra', '100') }}" oninput="formatNumberLive(this)" data-format="number" inputmode="numeric" pattern="[0-9,.]*">

    <label>Annual Property Tax ($)</label>
    <input type="text" name="tax" value="{{ request.form.get('tax', '2500') }}" oninput="formatNumberLive(this)" data-format="number" inputmode="numeric" pattern="[0-9,.]*">

    <label>Annual Insurance Premium ($)</label>
    <input type="text" name="insurance" value="{{ request.form.get('insurance', '1500') }}" oninput="formatNumberLive(this)" data-format="number" inputmode="numeric" pattern="[0-9,.]*">
    
    <label>Annual HOA Dues ($)</label>
    <input type="text" name="HOA" value="{{ request.form.get('HOA', '0') }}" oninput="formatNumberLive(this)" data-format="number" inputmode="numeric" pattern="[0-9,.]*">

    <label>Annual Maintenance and Repairs (%)</label>
    <input type="text" name="repairs" value="{{ request.form.get('repairs', '2') }}" oninput="formatNumberLive(this)" data-format="decimal" inputmode="numeric" pattern="[0-9.]*">

    <button type="submit">Calculate Payment</button>
</form>

{% if result %}
<div class="result-box">
    {% if result.error %}
        <p style="color: red;">{{ result.error }}</p>
    {% else %}
        <p><b>Base monthly payment:</b> ${{ result.monthlyPayment }}</p>
        <p><b>Total monthly payment:</b> ${{ result.monthlyPayment + result.extra }}</p>
        <p><b>Payoff WITHOUT extra payment:</b> {{ result.payoff1 }} and ${{ result.totalInterest }}K in interest paid.</p>
        <p><b>Payoff WITH extra payment:</b> {{ result.payoff2 }} and ${{ result.totalInterest2 }}K in interest paid.</p>
        <p><b>Total saved :</b> {{ result.saved }} and ${{ result.interestDifference }}k in interest.</p>

        <h3>Payoff Chart</h3>
        <img src="{{ result.plot }}" width="100%" alt = "Amortization plot">
    {% endif %}
</div>
{% endif %}

</body>
</html>
<script>
function formatNumberLive(input) {
    const cursorPos = input.selectionStart;

    // Remove everything except digits and decimal
    let raw = input.value.replace(/[^\d.]/g, '');

    // Allow only one decimal point
    const parts = raw.split('.');
    const integerPart = parts[0];
    const decimalPart = parts.slice(1).join(''); // drop extra dots

    // Format integer part with commas
    let formatted = integerPart
        ? Number(integerPart).toLocaleString('en-US')
        : '';

    // Reattach decimal if it exists
    if (raw.includes('.')) {
        formatted += '.' + decimalPart;
    }

    // Calculate cursor shift
    const diff = formatted.length - input.value.length;

    input.value = formatted;

    // Restore cursor safely
    const newCursorPos = cursorPos + diff;
    input.setSelectionRange(newCursorPos, newCursorPos);
}


function stripCommas(form) {
    const inputs = form.querySelectorAll('input[type="text"]');
    inputs.forEach(input => {
        input.value = input.value.replace(/,/g, '');
    });
}
document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll("input[data-format='number']").forEach(input => {
        formatNumberLive(input);
    });
});
</script>
